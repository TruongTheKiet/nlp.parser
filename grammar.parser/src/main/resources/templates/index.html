<html>
<meta charset="utf-8">
<title> Constituency Parser - Syntactic Tree Builder Application</title>
<script th:src="@{api/dvdeo.js}"></script>
<script th:src="@{api/dvdeo_2.js}"></script>
<script th:src="@{api/parser.js}"></script>
<script th:src="@{api/d3Tree.js}"></script>
<script th:src="@{jquery-3.6.0.min.js}"></script>

<script type="text/javascript">
	var defaultPTBText = "(S (NP-SBJ (NP (NNP Pierre) (NNP Vinken) ) (, ,) (ADJP (NP (CD 61) (NNS years) ) (JJ old) ) (, ,) ) (VP (MD will) (VP (VB join) (NP (DT the) (NN board) ) (PP-CLR (IN as) (NP (DT a) (JJ nonexecutive) (NN director) )) (NP-TMP (NNP Nov.) (CD 29) ))) (. .) )";
	var defaultCCGText = "(<T S[dcl] 0 2> (<T S[dcl] 1 2> (<T NP 0 2> (<T NP 0 2> (<T NP 0 2> (<T NP 0 1> (<T N 1 2> (<L N/N NNP NNP Pierre N_73/N_73>) (<L N NNP NNP Vinken N>) ) ) (<L , , , , ,>) ) (<T NP\\NP 0 1> (<T S[adj]\\NP 1 2> (<T NP 0 1> (<T N 1 2> (<L N/N CD CD 61 N_93/N_93>) (<L N NNS NNS years N>) ) ) (<L (S[adj]\\NP)\\NP JJ JJ old (S[adj]\\NP_83)\\NP_84>) ) ) ) (<L , , , , ,>) ) (<T S[dcl]\\NP 0 2> (<L (S[dcl]\\NP)/(S[b]\\NP) MD MD will (S[dcl]\\NP_10)/(S[b]_11\\NP_10:B)_11>) (<T S[b]\\NP 0 2> (<T S[b]\\NP 0 2> (<T (S[b]\\NP)/PP 0 2> (<L ((S[b]\\NP)/PP)/NP VB VB join ((S[b]\\NP_20)/PP_21)/NP_22>) (<T NP 1 2> (<L NP[nb]/N DT DT the NP[nb]_29/N_29>) (<L N NN NN board N>) ) ) (<T PP 0 2> (<L PP/NP IN IN as PP/NP_34>) (<T NP 1 2> (<L NP[nb]/N DT DT a NP[nb]_48/N_48>) (<T N 1 2> (<L N/N JJ JJ nonexecutive N_43/N_43>) (<L N NN NN director N>) ) ) ) ) (<T (S\\NP)\\(S\\NP) 0 2> (<L ((S\\NP)\\(S\\NP))/N[num] NNP NNP Nov. ((S_61\\NP_56)_61\\(S_61\\NP_56)_61)/N[num]_62>) (<L N[num] CD (null) 29 N[num]>) ) ) ) ) (<L . . . . .>) )";
	function onSub() {
		var textArea = document.getElementById("text");
		// Reset the colour
		textArea.style.color = "black";
		var data = textArea.value;
		// Escape backslashes
		data = data.replace(/\\/g, "\\\\");
		if(!data || data===''){
			return;
		}
		/*Call API for parse JSON*/
		$.ajax({
			url: $("#host").val() + "/rest/parse",
			contentType: "application/json",
			type: 'POSt',
			dataType: 'json',
			data : data,
			success: function (result) {
				var jsonData = parse(result.data);
				var sentenceString = "";
				sentenceString = getYield(jsonData, sentenceString);
				// Add the sentence (yield of the JSON tree) to the sentence container
				document.getElementById("sentence-container").innerHTML = "<p>"+sentenceString+"</p>";
				d3Tree(jsonData);
				return;
			},
			error: function (request, status, error) {
				alert(request.responseText)
			}
		});

		return false;
	}

	function getYield(node, string){
		if (node.children == null) string = string.concat(node.name, " ");
		else {
			for (var i in node.children) {
				var child = node.children[i];
				string = getYield(child, string);
			}
		}
		return string;
	}

	function loadTextArea(type) {
		var textArea = document.getElementById("text");
			textArea.style.color = "black";
		if (type == "PTB") textArea.value = defaultPTBText;
		else if (type == "CCG") textArea.value = defaultCCGText;
	}

	window.onload = function() {
		/*alert($("#host").val())*/
		var textArea = document.getElementById("text");
		textArea.onfocus = function() {
			textArea.style.color = "black";
			if (textArea.value == "Enter your text here...")
				textArea.value = "";
		};
		textArea.onblur = function() {
			if (textArea.value == "") {
				textArea.style.color = "grey";
				textArea.value = "Enter your text here...";
			}
		}
	}
</script>
<link rel="stylesheet" type="text/css" th:href="@{api/tree-viewer.css}">
<!-- General stylesheet -->
<body>
	<div class="wrapper" style="margin-top: 5mm">
		<div style="text-align: center;">
			<div id="input-text">
				<!--Initialise the default text with grey -->
				<textarea id="text" rows="5" style="color: grey;">Enter your tree here...</textarea>
			</div>
			<div id="input-submit">
				<br/><input type="submit" id="submit-button" value="View Tree" onclick="return onSub();" />
			</div>
			<div id="tree-container" style="margin-top: 10mm"></div>
			<div id="sentence-container"></div>
		</div>
		<input type="hidden" id="host" th:value="${host}"/>
	</div>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-45185696-1', 'christos-c.com');
		ga('send', 'pageview');

	</script>
</body>
</html>